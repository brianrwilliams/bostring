\section{Global sections of the factorization algebra} 

%First, consider the elliptic complex
%\ben
%\Omega^{0,*}(\Sigma ; \cV)
%\een
%of $(0,*)$-forms with values in $\cV$. The differential is simply the $\dbar$ operator. We consider its shift $\Omega^{0,*}(\Sigma ; \cV)[-1]$ as an abelian local dg Lie algebra. In this way, the associated cotangent theory of the elliptic complex is defined as 
%\ben
%T^{*}[-1] (\Omega^{0,*}(\Sigma ; \cV)) = \Omega^{0,*}(\Sigma ; V) \oplus \Omega^{1,*}(\Sigma ; T_\Sigma^{1,0}) \Omega^{1,*}(\Sigma ; \cV^\vee) \oplus \ .
%\een 
%We write the fields as $\gamma \in \Omega^{0,*}(\Sigma ; \cV)$ for the base direction and $\beta \in \Omega^{1,*}(\Sigma ; \cV^\vee)$ for the fiber direction. With this notation, the action functional is defined as
%\ben
%S (\beta, \gamma) = \int_\Sigma \<\beta, \dbar \gamma\>_\cV
%\een
%where $\<-,-\>_\cV$ denotes the evaluation pairing between $\cV$ and its dual. This theory is called the $\beta\gamma$ (or sometimes $\beta \gamma-bc$ \owen{what are the $bc$ fields?}) system with values in $\cV$. This is a free field theory and hence has a natural quantization. We will denote the factorization algebra of quantum observables on $\Sigma$ by $\Obs^{q}_{\cV}$. 

Thus far we have discussed the local behavior of the holomorphic string,
such as its quantization on a disk and the concomitant vertex algebra.
Now we turn to its global behavior, 
particularly the observables on a closed Riemann surface,
and the relationship with certain natural holomorphic vector bundles on the moduli space of Riemann surfaces.
This local-to-global transition is where the BV/factorization package really shines.
On the one hand, the theory of factorization algebras provides a conceptual characterization of the local-to-global relationship,
much like the understanding of sheaf cohomology as the derived functor of global sections.
On the other hand, the examples from BV quantization provide computable, convenient models for the global sections,
much as the de Rham or Dolbeault complexes do for the cohomology of sheaves that arise naturally in differential or complex geometry.

As we will explain, the answers we recover for the holomorphic string can be related quite cleanly to natural determinant lines on the moduli of Riemann surfaces,
hence providing a bridge from the Feynman diagrammatic anomaly computations to the index-theoretic computations.

\subsection{The free case}

% Let $\Sigma$ denote a Riemann surface. 

Before jumping to the holomorphic string, 
we will work out the global observables in the simpler case of the $bc\beta\gamma$ system,
introduced in Remark \ref{rmk:bcbg}. 
The global {\it classical}\/ observables on a Riemann surface $\Sigma$ are given by the symmetric algebra on the continuous linear dual to the fields,
\[
\Sym\left(\Omega^{0,*}(\Sigma,V)^\vee \oplus \Omega^{1,*}(\Sigma,V^\vee)^\vee \oplus \Omega^{0,*}(\Sigma,\cT[1])^\vee \oplus \Omega^{1,*}(\Sigma,\cT^*_\Sigma[-2])^\vee \right),
\]
with the differential $\dbar$ extended as a derivation.
\owen{I think I'm not being consistent with your notation for tangent bundles. Let's discuss what we want to use.}
Hence the cohomology is
\[
\Sym\left(H^*(\Sigma,V)^\vee \oplus H^*(\Sigma,\omega \otimes V^\vee)^\vee \oplus H^*(\Sigma,\cT[1])^\vee \oplus H^*(\Sigma,\omega^{\otimes 2}[-2])^\vee\right),
\]
where $\omega$ denotes the canonical bundle.
Although this expression might look complicated, 
it can be readily unpacked in the setting of algebraic geometry, 
particularly when $\Sigma$ is closed.
In that case, this graded commutative algebra is a symmetric algebra on a finite-dimensional graded vector space,
which encodes the derived tangent space of the moduli of Riemann surfaces at $\Sigma$ and of holomorphic functions to~$V$.

As this theory is free, it admits a canonical BV quantization.
Denote by $\Obs^{\q}_{free}$ be the corresponding factorization algebra.
One can compute its global sections on $\Sigma$ by using a spectral sequence whose first page is the global classical observables.
As mentioned in \owen{cite the relevant lesson about determinants}, 
when $\Sigma$ is closed,
the cohomology is the determinant of the cohomology of the fields:
\ben
H^*\left(\Obs^\q_{free}(\Sigma)\right) \cong \det \left(H^*(\Sigma ; \sO_\Sigma) \right)^{\tensor \dim(V)} \tensor \det \left(H^*(\Sigma ; T_\Sigma^{1,0})\right)^{-1} [d(\Sigma)] 
\een
where 
\ben
d(\Sigma) = \dim (V)  \left(\dim H^0(\Sigma ; \sO_\Sigma) + \dim H^1(\Sigma ; \sO_\Sigma)\right) + \dim(H^0(\Sigma ; T_\Sigma^{1,0})) - \dim(H^1(\Sigma ; T_\Sigma^{1,0})).
\een
(See Proposition 8.1.4.1 in \cite{fact1} for the proof of this fact.)

\begin{rmk}
\owen{Should this be a remark or just a paragraph?}
The shift $d(\Sigma)$ here likely looks funny.
In this case at least, the meaning can be unpacked pretty straightforwardly. 
The BV complex for an ordinary finite-dimensional vector space is equivalent to the de Rham complex shifted down by the dimension of the vector space, 
so that the top forms are in degree 0.
(Abstracting this situation is one way to ``invent'' the BV formalism.)
For the $\sigma$-model, the global solutions to the equations of motion are $H^0(\Sigma,\sO) \otimes V$ for the $\gamma$ fields and $H^0(\Sigma,\omega) \otimes V^\vee$ for the $\beta$ fields.
For $\Sigma$ closed, these are finite-dimensional, and thus we get the shift
\[
 \dim (V)  \left(\dim H^0(\Sigma ; \sO_\Sigma) + \dim H^1(\Sigma ; \sO_\Sigma)\right).
\]
For the ghost system (the $bc$ fields), 
the BV complex recovers the Euler characteristic 
\[
\dim(H^0(\Sigma ; T_\Sigma^{1,0})) - \dim(H^1(\Sigma ; T_\Sigma^{1,0}))
\]
as it encodes the de Rham complex on the formal quotient stack $B\fg = \ast/\fg$ for the Lie algebra of symmetries~$\fg$.
\end{rmk}

The computation here works for any Riemann surface $\Sigma$ and, indeed, for any family of Riemann surfaces.
Hence it implies that the global observables of the free $bc\beta\gamma$ system determine a determinant line bundle on the moduli $\cM$ of Riemann surfaces.

We can work out the first Chern class of this determinant line bundle using the Grothendieck-Riemann-Roch theorem as follows.
Consider the universal Riemann surface $\pi \colon C \to \cM$ over the moduli space, 
and consider the bundles $\sO_C \otimes V$ and $\sT_{C/\cM}$,
which one can view the universal $\gamma$ fields and $c$ fields, respectively.
The first Chern class of the derived pushforward $R\pi_*(\sO_C \otimes V)$ is given by the first Chern class of $\det(H^*(\sO_C \otimes V)) \cong \det(\sO_C)^{\otimes \dim V}$, 
since the first Chern class of a vector bundle is the first Chern class of its determinant bundle.
But the GRR theorem tells us that \owen{finish this!}

the global observables $H^*\left(\Obs^\q_{free}(C)\right)$ as a bundle over $C$.
\[
c_1\left(H^*\left(\Obs^\q_{free}(\Sigma)\right)\right) = 
\]

%\begin{lem}[\cite{fact1} Proposition 8.1.4.1]
%\label{lem bg global obs} 
%Let $b_i = \dim H^i (\Sigma ; \cV)$. The cohomology of the global observables of the $\beta\gamma$ system with values in $\cV$ is given by
%\ben
%H^*\left(\Obs^q_{\cV}(\Sigma)\right) \cong \det \left(H^*(\Sigma ; \cV) \right) [d(\cV)] 
%\een
%where $d(\cV) = -b_0 - b_1$. 
%\end{lem}

\owen{It would be good here to point out the GRR argument for identifying the first Chern class of this determinant line bundle. We can then point out that it resonates with our computation on the formal disk and give a reminder that this is a manifestation of ``Virasoro uniformization.'' This then leads into the string case: the holomorphic vector fields (rather the free $bc$ system) also contribute a determinant line (we should include that computation) and we can ask when those determinant lines tensor to a trivial line. Note that deforming the action from free $bc\beta\gamma$ system to holomorphic bosonic string doesn't affect the line bundles, since those are continuous parameters and Chern classes are discrete.}

\subsection{The anomaly and the deformation complex on a Riemann surface}

We have already seen that the holomorphic string {\it on a disk} admits a BV quantization if and only if the target is a complex vector space of dimension 13.
Here we will explain why this anomaly calculation is actually enough to show the existence of a quantization on an {\it arbitrary} Riemann surface. 

It is clear that \owen{I'm rarely a fan of this phrase \dots} in the case of a flat target that the only anomaly is purely a functional of the $c$ fields,
\owen{Could I write ``Our diagrammatic arguments showed that only wheels with $c$ legs appear,
and these arguments did not depend on the choice of $\Sigma$. Hence the anomaly will be purely a functional on the $c$ fields.''}
and so we only need to understand the component of the deformation complex that consists of local functionals depending just on the $c$ fields.
By arguments analogous to those in Section \ref{sec: moduli}, 
when $\Sigma$ is the disk,
this component is quasi-isomorphic to $\cred(W_1)[2]$,
whose cohomology is $\CC$ concentrated in degree 1.
More generally, the deformation complex is a sheaf of cochain complexes on $\Sigma$, 
and Proposition 5.3 of \ref{bw} shows that this sheaf of complexes is quasi-isomorphic to the constant sheaf $\CC_\Sigma[-1]$ concentrated in degree $+1$. 
A main result of BV quantization \cite{CosBook} \owen{maybe give precise reference} is that anomalies are {\em local}: the anomaly computed on an open set $U \subset \Sigma$ is equal to the anomaly of the theory on $\Sigma$ restricted to $U$. 
In our case, the anomaly on some Riemann surface $\Sigma$ must match with the anomaly we have already computed if we take $U$ to be a disk in $\Sigma$.
This global anomaly is a 1-cocycle for the derived global sections of the shifted constant sheaf, 
and hence, because of the shift, this cocycle is determined by a constant function on $\Sigma$.
Thus, it suffices to compute the anomaly on an arbitrary open, 
in particular, it suffices to compute it on a flat disk. 
But this is precisely the context in which we computed the anomaly in Section~\ref{sec:quantization}, 
so we know the anomaly is simply the dimension of the target vector space.
Thus, a quantization of the holomorphic string exists on any Riemann surface provided $\dim_{\CC}(V) = 13$. 

Now we turn to the moduli of theories.
Indeed, by the calculation in Section \ref{sec: moduli}, 
we see that \owen{this phrase is really unwieldy} the space of deformations for quantizations at one loop are a torsor for the vector space
\ben
H^0(\Sigma) \tensor \Omega^1(V) \oplus H^1(\Sigma) \tensor \Omega^2_{cl}(V) .
\een 
Thus, the space of deformations is given by a space of continuous parameters and hence will not change the class of the line bundle of global observables. 
In conclusion, we are free to choose any one-loop quantization; this will not affect the cohomology of the global observables. 

\subsection{}

Now, let us consider the global observables of the bosonic string $\Obs^\q(\Sigma)$. 
There is a spectral sequence converging to the cohomology of the global observables $H^*\Obs^\q(\Sigma)$ with $E_2$ page given by the cohomology of the global observables of the $bc\beta \gamma$ system which we have already computed:
\bestar
E_2 & \cong & \det\left(H^*(\Sigma ; \cT_\Sigma[1])\right) \tensor \det \left(H^*(\Sigma ; \cO_\Sigma)^{\oplus 13}\right) \\
& \cong & \det \left(H^1(\Sigma ; \cT_\Sigma) \right) \tensor \det \left(H^0(\Sigma ; \cT_\Sigma)\right)^{-1} \tensor \det \left(H^0(\Sigma ; K_{\Sigma}) \right)^{-13}
\eestar
where we have used the fact that $H^0(\Sigma ; \cO) \cong \CC$ for any $\Sigma$. 

Let $\Sigma_{g}$ be a surface of genus $g$. Then for $g=1$ the above simplifies to
\ben
\det \left(H^1(\Sigma_1 ; \cT_{\Sigma_1})\right) \tensor \det \left(H^0(\Sigma_1 ; K) \right)^{-14} .
\een 
If $g \geq 2$ one has
\ben
\det \left(H^1(\Sigma_1 ; \cT_{\Sigma_1})\right) \tensor \det \left(H^0(\Sigma_1 ; K) \right)^{-13} .
\een
It is clear that the spectral sequence degenerates at this page. Thus the above expressions give the global observables for the holomorphic string for genus $g =1$ and $g \geq 2$, respectively. 

\section{The string partition function on an elliptic curve}

We will evaluate the partition function of the theory on an elliptic curve. 
For $\tau \in \HH$, the upper half plane, we can write an elliptic curve as a quotient of $\CC$ by the lattice $\ZZ + \tau \ZZ$
\ben
E_\tau = \CC / (\ZZ + \tau \ZZ) .
\een 
Let $\d^2 z = \d z \d \zbar$ be the volume form on $\CC$ which descends to one on $E_\tau$ that we denote by the same name. 

We have already discussed the gauge fixing operator and constructed the heat kernel that regularizes the operator $\dbar^{-1}$ on $\CC$. 
We can make the same choice of gauge fixing operator, namely $\dbar^*$, on the elliptic curve $E_\tau$ and hence we obtain a heat kernel for the operator $e^{-t D^{E_\tau}}$ where $D^{E_\tau}$ is the commutator $[\dbar, \dbar^*] = \frac{1}{2} \Delta$ on $E_\tau$. 
Explicitly, the heat kernel of the operator $e^{-t D^{E_\tau}}$ on the elliptic curve $E_\tau$ pulled back to the universal cover $\CC$ along the $\CC \to E_\tau$ is of the form
\ben 
K^{E_\tau}_t (z,w) = \sum_{\lambda \in \ZZ + \tau \ZZ} \frac{1}{2\pi t} e^{-|z-w + \lambda|^2 / 2 t} (\d z - \d w) (\d \zbar - \d \wbar ) .
\een
From $K_t^{E_\tau}$ we obtain the propagator $P_{\ell < L}^{E_\tau} = \dbar^* \int_{\ell}^L e^{-t D^{E_\tau}} \d t$ just as above. 

This propagator regularizes the operator $\dbar^{-1}$ on $E_\tau$. 
The full propagator of the holomorphic string on $E_\tau$ has one component coming from the pairing between the fields $\beta$ and $\gamma$ and another component coming from the pairing between the fields $b$ and $c$. 
Since $\gamma$ is a section of the trivial vector bundle labeled by the vector space $V$, the first term in the full propagator is of the form $P_{\ell < L}^{E_\tau} \tensor \frac{1}{2} (\id_V + \id_{V^*})$.
Now, since the tangent bundle is trivial on an elliptic curve we can choose a canonical framing and write the second piece of the propagator describing the pairing between $b$ and $c$ as $P_{\ell < L}^{E_\tau} \tensor (\partial_z \tensor \partial_z^\vee + \partial_z^\vee \tensor \partial_z)$ where $\partial_z, \partial_z^\vee$ denote the canonical framing of $T_{E_\tau}, T_{E_\tau}*$ respectively. 

Just as in the case of the calculation of the anomaly, the propagator will is a sum over wheels that are functionals of the $c$-fields. 
Unlike the case of the anomaly, the internal edges of the wheels are all labeled by the propagator. 
The vertices are labeled by the interaction terms which have two types: a $\beta c \gamma$-type interaction and a $bcc$-type interaction. 
Thus, the partition function splits up into a sum of two types of diagrams (\ref{diagram:partition}): A) all input legs labeled by the fields $c$ with each internal edge labeled by the $\beta\gamma$ propagator $P_{\ell < L}^{E_\tau} \tensor \frac{1}{2} (\id_V + \id_{V^*})$, and B) all input legs labeled by the fields $c$ with each internal edge labeled by the $bc$ propagator $P_{\ell < L}^{E_\tau} \tensor (\partial_z \tensor \partial_z^\vee + \partial_z^\vee \tensor \partial_z)$. 
\brian{draw diagrams}

For $j \geq 1$ let $A^{E_\tau}_j$ (respectively $B^{E_\tau}_j$) be the weight of the graph of type $A$ (respectively $B$) with $j$ incoming legs.

\begin{lem} Consider the weight of the tadpole diagram of type $A$, $A^{E_\tau}_1(c)$. Evaluated on the generator $c = \d \zbar \partial_z$ one has
\ben
A_1^{E_\tau} (\zbar \partial_z) = \# (- 2) \cdot (13) \cdot E_2^*(\tau) 
\een
\brian{WORK OUT FACTOR} .
Similarly, the weight of the tadpole diagram of type $B$ evaluated on the generator is given by
\ben
B_1^{E_\tau} (\zbar \partial_z) = \# (2) \cdot E_2^*(\tau) .
\een 
\end{lem}

We obtain the weight of the diagrams with two or more vertices by the following inductive formula. 

\begin{lem} One has $\partial_\tau A^{E_\tau}_{j} = \# A^{E_\tau}_{j+1}$ and $\partial_\tau B_j^{E_\tau} = \# B_{j+1}^{E_\tau}$.
\end{lem}

We conclude the following. 

\begin{prop} The partition function of the holomorphic bosonic string is the formal power series expansion of the holomorphic function $-24 \log \eta (t)$ near the point $t = \tau \in \HH$. 
\end{prop}

\owen{If possible, it would be cool to explain how one can extract the differential equations (=flat connection) governing the partition function from our construction. This might be too hard right now \dots}
